/**
  @file             mmu_test.c
  @version          0.0.0.0

  @brief            The MMU test code
  @details

  Project           M4_ETH_PROJECT_NAME
  Platform          M4_ETH_PLATFORM

  SWVersion         M4_ETH_RELEASE_VERSION

  Copyright (c) 2016 NXP Semiconductors
  All Rights Reserved.
*/
/*==================================================================================================
==================================================================================================*/

/*==================================================================================================
                                         MISRA VIOLATIONS
==================================================================================================*/

/*==================================================================================================
                                         INCLUDE FILES
 1) system and project includes
 2) needed interfaces from external units
 3) internal and external interfaces from this unit
==================================================================================================*/
#include "common_types.h"
#include "mmu_mem_attr.h"
#include "mmu_cfg.h"
#include "mmu.h"

/*==================================================================================================
                                      FILE VERSION CHECKS
==================================================================================================*/

/*==================================================================================================
                                        LOCAL MACROS
==================================================================================================*/

/*==================================================================================================
                          LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
==================================================================================================*/

/*==================================================================================================
                                       LOCAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
                                       LOCAL VARIABLES
==================================================================================================*/

/*==================================================================================================
                                       GLOBAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
                                       GLOBAL VARIABLES
==================================================================================================*/

/*==================================================================================================
                                   LOCAL FUNCTION PROTOTYPES
==================================================================================================*/

/*==================================================================================================
                                       LOCAL FUNCTIONS
==================================================================================================*/

/*==================================================================================================
                                       GLOBAL FUNCTIONS
==================================================================================================*/
void entry_c(void)
{
    unsigned int regval;
    int failure = 0;
    
/*  Turn the MMU ON  */
/*
    if (MMU_E_OK != mmu_self_test())
        failure++;
*/
    if (mmu_init())
        failure++;
    
    /*  DDR1 */
    if (mmu_add_mapping(0xC0000000, 0xC0000000, 0x40000000, mmu_get_attr(MTYPE_NORMAL, MA_EL2_EL3_RW)))
        failure++;
    /*  DDR0 */
    if (mmu_add_mapping(0x80000000, 0x80000000, 0x30000000, mmu_get_attr(MTYPE_NORMAL_NC, MA_EL2_EL3_RW)))
        failure++;
    if (mmu_add_mapping(0xB0000000, 0xB0000000, 0xc000, mmu_get_attr(MTYPE_NORMAL, MA_EL2_EL3_RW)))
        failure++;
    if (mmu_add_mapping(0xB000c000, 0xB000c000, 0x6000, mmu_get_attr(MTYPE_NORMAL_NC, MA_EL2_EL3_RW)))
        failure++;
    if (mmu_add_mapping(0xB0012000, 0xB0012000, 0xfee000, mmu_get_attr(MTYPE_NORMAL, MA_EL2_EL3_RW)))
        failure++;
    /*  PBRIDGE0 Peripherals */
    if (mmu_add_mapping(0x40000000, 0x40000000, 0x00080000, mmu_get_attr(MTYPE_DEVICE, MA_EL2_EL3_RW)))
        failure++;
    /*  PBRIDGE1 Peripherals */
    if (mmu_add_mapping(0x40080000, 0x40080000, 0x00080000, mmu_get_attr(MTYPE_DEVICE, MA_EL2_EL3_RW)))
        failure++;
    
    if (MMU_E_OK != mmu_start())
        while(1);
    
    cache_d_clean_by_va_range(0xC0000000, 0x40000000);
    
    while(1)
       regval++;
}
